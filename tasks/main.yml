---
- name: Download Atlas Upload
  become: yes
  get_url:
      url: "https://releases.hashicorp.com/atlas-upload-cli/{{hashicorp_atlas_upload_version}}/atlas-upload-cli_{{hashicorp_atlas_upload_version}}_linux_amd64.zip"
      dest: "{{ansible_user_dir}}/atlas-upload-cli-{{hashicorp_atlas_upload_version}}.zip"
      mode: 0444
  when: hashicorp_atlas_upload_install

- name: Unzip Atlas Upload
  become: yes
  unarchive:
      src: "{{ansible_user_dir}}/atlas-upload-cli-{{hashicorp_atlas_upload_version}}.zip"
      dest: /usr/local/bin
      copy: no
      owner: "{{ansible_user_uid}}"
      group: "{{ansible_user_gid}}"
      mode: 0555
      creates: /usr/local/bin/atlas-upload
  when: hashicorp_atlas_upload_install

- name: Test Atlas Upload
  command: /usr/local/bin/atlas-upload --version

- name: Download Consul
  become: yes
  get_url:
      url: "https://releases.hashicorp.com/consul/{{hashicorp_consul_version}}/consul_{{hashicorp_consul_version}}_linux_amd64.zip"
      dest: "{{ansible_user_dir}}/consul-{{hashicorp_consul_version}}.zip"
      mode: 0444
  when: hashicorp_consul_install

- name: Unzip Consul
  become: yes
  unarchive:
      src: "{{ansible_user_dir}}/consul-{{hashicorp_consul_version}}.zip"
      dest: /usr/local/bin
      copy: no
      owner: "{{ansible_user_uid}}"
      group: "{{ansible_user_gid}}"
      mode: 0555
      creates: /usr/local/bin/consul
  when: hashicorp_consul_install

- name: Test Consul
  command: /usr/local/bin/consul --version

- name: Download Consul Replicate
  become: yes
  get_url:
      url: "https://releases.hashicorp.com/consul-replicate/{{hashicorp_consul_replicate_version}}/consul-replicate_{{hashicorp_consul_replicate_version}}_linux_amd64.zip"
      dest: "{{ansible_user_dir}}/consul-replicate-{{hashicorp_consul_replicate_version}}.zip"
      mode: 0444
  when: hashicorp_consul_replicate_install

- name: Unzip Consul Replicate
  become: yes
  unarchive:
      src: "{{ansible_user_dir}}/consul-replicate-{{hashicorp_consul_replicate_version}}.zip"
      dest: /usr/local/bin
      copy: no
      owner: "{{ansible_user_uid}}"
      group: "{{ansible_user_gid}}"
      mode: 0555
      creates: /usr/local/bin/consul-replicate
  when: hashicorp_consul_replicate_install

- name: Test Consul Replicate
  command: /usr/local/bin/consul-replicate --version

- name: Download Consul Template
  become: yes
  get_url:
      url: "https://releases.hashicorp.com/consul-template/{{hashicorp_consul_template_version}}/consul-template_{{hashicorp_consul_template_version}}_linux_amd64.zip"
      dest: "{{ansible_user_dir}}/consul-template-{{hashicorp_consul_template_version}}.zip"
      mode: 0444
  when: hashicorp_consul_template_install

- name: Unzip Consul Template
  become: yes
  unarchive:
      src: "{{ansible_user_dir}}/consul-template-{{hashicorp_consul_template_version}}.zip"
      dest: /usr/local/bin
      copy: no
      owner: "{{ansible_user_uid}}"
      group: "{{ansible_user_gid}}"
      mode: 0555
      creates: /usr/local/bin/consul-template
  when: hashicorp_consul_template_install

- name: Test Consul Template
  command: /usr/local/bin/consul-template --version
