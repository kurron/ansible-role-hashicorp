---
- name: Download Atlas Upload
  become: yes
  get_url:
      url: "https://releases.hashicorp.com/atlas-upload-cli/{{hashicorp_atlas_upload_version}}/atlas-upload-cli_{{hashicorp_atlas_upload_version}}_linux_amd64.zip"
      dest: "{{ansible_user_dir}}/atlas-upload-cli-{{hashicorp_atlas_upload_version}}.zip"
      mode: 0444
  when: hashicorp_atlas_upload_install

- name: Unzip Atlas Upload
  become: yes
  unarchive:
      src: "{{ansible_user_dir}}/atlas-upload-cli-{{hashicorp_atlas_upload_version}}.zip"
      dest: /usr/local/bin 
      copy: no 
      owner: "{{ansible_user_uid}}"
      group: "{{ansible_user_gid}}"
      mode: 0555
      creates: /usr/local/bin/atlas-upload
  when: hashicorp_atlas_upload_install

- name: Test Atlas Upload
  command: /usr/local/bin/atlas-upload --version
